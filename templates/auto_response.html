<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <link rel="icon" href="/static/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/common_0.css">
    <link rel="stylesheet" href="/static/css/index_1.css">
    <link rel="stylesheet" href="/static/css/tmIndex_11.css">
    <link rel="stylesheet" href="/static/css/ucIndex_12.css">
    <link rel="stylesheet" href="/static/css/pcIndex_13.css">
    <script src="/static/tj.js"></script>
    <title>自动回复 | 栗子云</title>
    <link href="/static/static_inside/css/bundle.e9f3923a.css" rel="stylesheet">
    <script src="/static/jquery-3.3.1.min.js"></script>
    <link rel='stylesheet' href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel='stylesheet' href="/static/bootstrap-3.3.7-dist/css/bootstrap-select.min.css">
    <script src="/static/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap-3.3.7-dist/js/bootstrap-select.min.js"></script>

</head>
<body style="position: absolute">
<div class="form-group hide" id="form-group"
     style="margin-left: 0px; position: fixed; z-index: 1; left: 11.7%; top: 17.5%;">
    <div class="col-sm-4">
        <select id="group_name" name="group_name"
                class="selectpicker show-tick form-control"
                multiple
                data-live-search="true" multiple title="选择目标微信群"
                data-width="200px" data-height="200px"
                data-actions-box="true" data-selected-text-format="count > 2">
            {% for group_info in groups %}
            <option value="{{group_info['group_id']}}">{{group_info['group_name']}}</option>
            {% end %}
        </select>
    </div>
</div>
<div class="app" id="root" style="user-select: auto;">
    <div class="mainLayout">
        <div class="layoutHeader">
            <div class="left">
                <div class="icon-logo"
                     style="background-image: url('/static/images/icon/beats-logo2.png'); margin: -15px 0px 10px 10px; width: 60px; height: 60px"></div>
                <div class="icon-logo"></div>
            </div>
            <div class="center" style="float: left;"><a href="/v2/gmscope"><span class="menu active">微信群</span></a><a
                    href="/v2/mtscope"><span class="menu">群发</span></a><a href="/v2/gbscope"><span
                    class="menu">拉新</span></a><a href="/v2/dashboard"><span class="menu">统计</span></a><a
                    href="/v2/mlscope"><span class="menu">素材</span></a><a href="/v2/system"><span class="menu">设置</span></a>
            </div>
            <div class="monitorStateWrapper">
                <div class="stateTitle" tabindex="1">
                    <div class="monitorStateBox" style="display: none;">
                        <div class="exit">退出登录</div>
                    </div>
                </div>
                <div class="newsBox" tabindex="1"></div>
                <div class="helpBox"><span class="icon-home help"></span></div>
                <div class="modalWrapper" style="display: none;">
                    <div class="modalBox newsList">
                        <div class="item-title">消息通知<span class="closeBtn"></span></div>
                        <div style="overflow: auto; height: calc(100% - 66px);">
                            <ul style="margin: 0px;">
                                <li class="item"><p class="title"><span>还有4天的免费试用期</span><span class="time">2019-06-05 06:00:01</span>
                                </p>
                                    <p class="content">你的试用版即将到期，请及时联系客服购买栗子云。</p></li>
                                <li class="item"><p class="title"><span>还有4天的免费试用期</span><span class="time">2019-06-04 06:00:01</span>
                                </p>
                                    <p class="content">你的试用版即将到期，请及时联系客服购买栗子云。</p></li>
                                <li class="item"><p class="title"><span>还有4天的免费试用期</span><span class="time">2019-06-03 06:00:00</span>
                                </p>
                                    <p class="content">你的试用版即将到期，请及时联系客服购买栗子云。</p></li>
                                <li class="item"><p class="title"><span>还有5天的免费试用期</span><span class="time">2019-06-02 06:00:00</span>
                                </p>
                                    <p class="content">你的试用版即将到期，请及时联系客服购买栗子云。</p></li>
                                <li class="item"><p class="title"><span>还有6天的免费试用期</span><span class="time">2019-05-30 06:00:01</span>
                                </p>
                                    <p class="content">你的试用版即将到期，请及时联系客服购买栗子云。</p></li>
                                <li class="item"><p class="title"><span>还有7天的免费试用期</span><span class="time">2019-05-29 06:00:00</span>
                                </p>
                                    <p class="content">你的试用版即将到期，请及时联系客服购买栗子云。</p></li>
                                <li class="item"><p class="title"><span>导入群成功</span><span class="time">2019-05-28 17:42:57</span>
                                </p>
                                    <p class="content">群【未命名(待修改)】于"2019-05-28 17:42:56"导入系统成功！</p></li>
                                <li class="item"><p class="title"><span>绑定栗子云用户成功</span><span class="time">2019-05-28 17:40:46</span>
                                </p>
                                    <p class="content">微信用户【个儿】于"2019-05-28 17:40:45"绑定栗子云账号成功！</p></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layoutSideNavi">
            <div class="menuHeader"></div>
            <div class="menuList"><a href="/u/{{user_name}}/control"><span class="menu"><span
                    class="icon-menu gmscope"></span>群消息</span></a><a href="/u/{{user_name}}/manage_group"><span
                    class="menu"><span class="icon-menu giscope"></span>群管理</span></a><a
                    href="/u/{{user_name}}/welcome"><span class="menu"><span
                    class="icon-menu welcome"></span>入群欢迎</span></a><a
                    href="/u/{{user_name}}/auto_response"><span class="menu active"><span
                    class="icon-menu arscope"></span>自动回复</span></a><a
                    href="/u/{{user_name}}/protect"><span class="menu"><span
                    class="icon-menu protect"></span>违规监测</span></a>
            </div>
        </div>
        <div class="layoutContent">
            <div class="gar-wrapper">
                <div class="gw-btnBox">
                    <div class="ButtonBox green" onclick="create_welcome()">创建回复</div>
                    <div class="ButtonBox black" style="width: 78px; margin-left: 20px;">全部停用</div>
                </div>
                <div class="gar-table">
                    <div class="lzc-table">
                        <div class="ant-table-wrapper">
                            <div class="ant-spin-nested-loading tableLoading">
                                <div class="ant-spin-container">
                                    <div class="ant-table ant-table-default ant-table-scroll-position-left">
                                        <div class="ant-table-content">
                                            <div class="ant-table-body">
                                                <table class="">
                                                    <colgroup>
                                                        <col>
                                                        <col>
                                                        <col>
                                                        <col>
                                                        <col>
                                                    </colgroup>
                                                    <thead class="ant-table-thead">
                                                    <tr>
                                                        <th class=""><span>关键词</span></th>
                                                        <th class=""><span>回复内容</span></th>
                                                        <th class=""><span><span>覆盖群<span
                                                                style="color: rgb(185, 188, 197);">(个)</span></span></span>
                                                        </th>
                                                        <th class=""><span>触发条件</span></th>
                                                        <th class=""><span>操作</span></th>
                                                    </tr>
                                                    </thead>
                                                    <tbody class="ant-table-tbody">
                                                    <tr class="ant-table-row  ant-table-row-level-0" data-row-key="0">
                                                        <td class=""><span class="ant-table-row-indent indent-level-0"
                                                                           style="padding-left: 0px;"></span>
                                                            <div class="kw-title" tabindex="0"><span
                                                                    class="keyName">关键词</span><span
                                                                    class="keyName">你好</span></div>
                                                        </td>
                                                        <td class="">
                                                            <div class="content"
                                                                 style="display: inline-block; cursor: pointer;">
                                                                <div class="content-txt">勒好 勒好</div>
                                                            </div>
                                                        </td>
                                                        <td class="">1</td>
                                                        <td class=""><span class="act-odds">全部触发</span></td>
                                                        <td class=""><span class="operate"><span
                                                                class="operateItem operate-edit"
                                                                style="background-image: url('/static/images/icon/icon-gb-v3.png')"></span><span
                                                                class="operateItem operate-delete"
                                                                style="background-image: url('/static/images/icon/icon-gb-v3.png')"></span><div
                                                                class="switch-box active  switch"><em></em><p>开</p></div></span>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lzc-miniPageRule" style="margin-bottom: 24px;">
                    <ul class="ant-pagination mini" unselectable="unselectable">
                        <li title="Previous Page" class="ant-pagination-disabled ant-pagination-prev"
                            aria-disabled="true"><a class="ant-pagination-item-link"></a></li>
                        <li title="1" class="ant-pagination-item ant-pagination-item-1 ant-pagination-item-active"
                            tabindex="0"><a>1</a></li>
                        <li title="Next Page" class="ant-pagination-disabled ant-pagination-next" aria-disabled="true">
                            <a class="ant-pagination-item-link"></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="app" id="modal-root"></div>
<div class="app" id="msg-root">
    <div class="msg-modal">
        <div class="msg-list"></div>
    </div>
</div>
<div id="qb-sougou-search" style="display: none; opacity: 0;"><p>搜索</p>
    <p class="last-btn">复制</p>
    <iframe src=""></iframe>
</div>

</div>

</body>
<script>
    var welcome_html = '<div class="gar-wrapper"><div class="gw-btnBox"><div class="ButtonBox green" onclick="create_welcome()">创建回复</div><div class="ButtonBox black" style="width: 78px; margin-left: 20px;">全部停用</div></div><div class="gar-table"><div class="lzc-table"><div class="ant-table-wrapper"><div class="ant-spin-nested-loading tableLoading"><div class="ant-spin-container"><div class="ant-table ant-table-default ant-table-scroll-position-left"><div class="ant-table-content"><div class="ant-table-body"><table class=""><colgroup><col><col><col><col><col></colgroup><thead class="ant-table-thead"><tr><th class=""><span>关键词</span></th><th class=""><span>回复内容</span></th><th class=""><span><span>覆盖群<span style="color: rgb(185, 188, 197);">(个)</span></span></span></th><th class=""><span>触发条件</span></th><th class=""><span>操作</span></th></tr></thead><tbody class="ant-table-tbody"></tbody></table></div></div></div></div></div></div></div></div><div class="lzc-miniPageRule" style="margin-bottom: 24px;"><ul class="ant-pagination mini" unselectable="unselectable"><li title="Previous Page" class="ant-pagination-disabled ant-pagination-prev" aria-disabled="true"><a class="ant-pagination-item-link"></a></li><li title="1" class="ant-pagination-item ant-pagination-item-1 ant-pagination-item-active" tabindex="0"><a>1</a></li><li title="Next Page" class="ant-pagination-disabled ant-pagination-next" aria-disabled="true"><a class="ant-pagination-item-link"></a></li></ul></div></div>';
    var welcome_create_html = '<div class="layoutContent"><div class="gw_build_wrapper"><div class="gw-stepTitle"><span class="back" onclick="back_welcome()"><em></em>返回</span><span class="bread"><span class="bread-back">自动回复 </span> / <span> 创建回复</span></span></div><div class="gw-build-main"><div class="MtEdit garEdit"><div class="mtstep-box"><div class="step-title-box"><p class="step-num">1</p><p class="step-title">选择目标群</p></div><div class="line-box"><div class="ButtonBox" style="width: 136px;">&gt;</div><div class="group-list" style="width: 677px;"></div></div></div><div class="mtstep-box"><div class="step-title-box"><p class="step-num">2</p><p class="step-title">编辑关键词</p></div><div class="line-box" id="edit_keyword"><div class="lzc-tagAdd-keyword"><span class="icon-add"></span><span class="add-text" onclick="edit_keyword()">添加关键词</span></div></div><div class="keywords-tag" style="margin-left: 35px" id="keywords_left" style="height: 36px;"><div class="keword-left"></div></div></div><div class="mtstep-box"><div class="step-title-box"><p class="step-num">3</p><p class="step-title">编辑内容</p></div><div class="line-box" id="edit_content" onclick="edit_content()"><div class="select-box"><ul class="select-title-box"><li class="text" onclick="content_input_show()"><em></em>文字</li><li class="img"><em></em>图片</li><li class="wxapp"><em></em>小程序</li></ul><div class="mt-activeContent"><pre id="pre-container" contenteditable="true" style="display: none;"></pre><div><pre contenteditable="true" placeholder="请输入回复的信息..." id="activeContent"></pre></div></div></div></div></div><div class="mtstep-box"><div class="step-title-box"><p class="step-num">4</p><p class="step-title">选择触发条件</p></div><div class="line-box stepBox-4"><em class="radio "></em><span class="txt1">仅在@小助手时触发</span><em class="mark"></em><span class="txt2">默认全部触发</span></div></div></div><div class="gw-edit-edit-btn"><div class="ButtonBox green" style="margin-right: 20px;" onclick="confirm_keyword()">创建</div><div class="ButtonBox cancel"  onclick="back_welcome()">取消</div></div></div></div></div>'
    var tr_html = '<tr class="ant-table-row  ant-table-row-level-0" data-row-key="0"><td class=""><span class="ant-table-row-indent indent-level-0" style="padding-left: 0px;"></span><div class="kw-title" tabindex="0"><span class="keyName">关键词</span><span class="keyName">你好</span></div></td><td class=""><div class="content" style="display: inline-block; cursor: pointer;"><div class="content-txt">勒好 勒好</div></div></td><td class="">1</td><td class=""><span class="act-odds">全部触发</span></td><td class=""><span class="operate"><span class="operateItem operate-edit" style="background-image: url(\'/static/images/icon/icon-gb-v3.png\')"></span><span class="operateItem operate-delete" style="background-image: url(\'/static/images/icon/icon-gb-v3.png\')"></span><div class="switch-box active  switch"><em></em><p>开</p></div></span></td></tr>';
    var keyword_html = '<div class="lzc-tagInput-keyword"><div ><input type="text" placeholder="添加关键词" class="tagIpt" value=""></div><div class="btnArea"><span class="confirm" onclick="add_keyword()">添加</span><span class="cancel" onclick="cancel_keyword()">取消</span></div></div>';
    var cancel_keyword_html = '<div class="lzc-tagAdd-keyword"><span class="icon-add"></span><span class="add-text" onclick="edit_keyword()">添加关键词</span></div>';

    function create_welcome() {
        $('.layoutContent').text('');
        $('.layoutContent').html(welcome_create_html);
        $('#keywords_left').hide();
        $('#form-group').removeClass('hide')
    }

    function back_welcome() {
        $('.layoutContent').text('');
        $('.layoutContent').html(welcome_html);
        $('.ant-table-tbody').append(tr_html);
        $('#form-group').addClass('hide')
    }

    function cancel_keyword() {
        console.log('cancel');
        $('#edit_keyword').text('');
        $('#edit_keyword').html(cancel_keyword_html);
        $('#keywords_left').hide();
    }

    function edit_keyword() {
        $('#edit_keyword').text('');
        $('#edit_keyword').html(keyword_html)
    }

    function add_keyword() {
        var head_html = '<span><div class="lzc-tag keyword"><span>';
        var body_data = $('.tagIpt').val();
        var foot_html = '</span><span class="close"></span></div></span>';
        $('#keywords_left').show();
        $('.tagIpt').val('');
        $('.keword-left').append(head_html + body_data + foot_html);
    }

    function confirm_keyword() {
        var groups = $('#group_name').selectpicker('val');
        var keyword_list = [];
        $('.keyword > span:first-child').each(function (index, value) {
            keyword_list.push($(value).text())
        });
        var keywords = keyword_list.join(',');
        var reply = $('#activeContent').html();
        var user_name = window.location.href.split('/')[4];
        console.log(groups, keywords, reply);

        if (groups.length == 0) {
            window.alert('请选择微信群');
            return
        }

        $.ajax({
            url: '/u/' + user_name + '/auto_response',
            type: 'post',
            dataType: 'json',
            data: {
                'group_ids': groups.join(','),
                'keywords': keywords,
                'reply': reply
            },
            success: function (data) {
                if (data['msg'] == 'success') {
                    window.alert('创建成功')
                }
                else {
                    window.alert('创建失败')
                }
                window.location.href = 'http://{{server_host}}:{{server_port}}/u/' + user_name + '/auto_response'
            }
        })

    }
    
    function edit_content() {

    }

</script>
</html>